{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <!-- Primary Meta Tags -->
    <title>{% block title %}Яркий Город - Рекламное агентство{% endblock %}</title>
    <meta name="title" content="{% block meta_title %}Яркий Город - Рекламное агентство{% endblock %}">
    <meta name="description" content="{% block meta_description %}Яркий Город - рекламное агентство полного цикла в Петрозаводске. Изготовление и монтаж наружной рекламы, вывески, световые буквы, оклейка авто.{% endblock %}">
    <meta name="keywords" content="{% block meta_keywords %}реклама, наружная реклама, Петрозаводск, вывески, световые буквы, оклейка авто, неон, интерьерные решения, холсты{% endblock %}">
    <meta name="author" content="Яркий Город">
    <meta name="robots" content="{% block meta_robots %}index, follow{% endblock %}">
    <meta name="language" content="Russian">
    <meta name="revisit-after" content="7 days">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="{% block canonical_url %}{{ request.build_absolute_uri }}{% endblock %}">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="{% block og_type %}website{% endblock %}">
    <meta property="og:url" content="{% block og_url %}{{ request.build_absolute_uri }}{% endblock %}">
    <meta property="og:title" content="{% block og_title %}Яркий Город - Рекламное агентство{% endblock %}">
    <meta property="og:description" content="{% block og_description %}Яркий Город - рекламное агентство полного цикла в Петрозаводске. Изготовление и монтаж наружной рекламы, вывески, световые буквы, оклейка авто.{% endblock %}">
    <meta property="og:image" content="{% block og_image %}{% if settings and settings.logo %}{{ request.scheme }}://{{ request.get_host }}{{ settings.logo.url }}{% else %}{{ request.scheme }}://{{ request.get_host }}{% static 'img/Logo.png' %}{% endif %}{% endblock %}">
    <meta property="og:locale" content="ru_RU">
    <meta property="og:site_name" content="Яркий Город">
    {% if settings %}
    <meta property="og:phone_number" content="{{ settings.phone }}">
    {% endif %}
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="{% block twitter_url %}{{ request.build_absolute_uri }}{% endblock %}">
    <meta name="twitter:title" content="{% block twitter_title %}Яркий Город - Рекламное агентство{% endblock %}">
    <meta name="twitter:description" content="{% block twitter_description %}Яркий Город - рекламное агентство полного цикла в Петрозаводске. Изготовление и монтаж наружной рекламы, вывески, световые буквы, оклейка авто.{% endblock %}">
    <meta name="twitter:image" content="{% block twitter_image %}{% if settings and settings.logo %}{{ request.scheme }}://{{ request.get_host }}{{ settings.logo.url }}{% else %}{{ request.scheme }}://{{ request.get_host }}{% static 'img/Logo.png' %}{% endif %}{% endblock %}">
    
    <!-- Geo Tags -->
    {% if settings and settings.address %}
    <meta name="geo.region" content="RU-KR">
    <meta name="geo.placename" content="Петрозаводск">
    {% endif %}
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{% static 'img/favicon.png' %}">
    <link rel="apple-touch-icon" href="{% static 'img/favicon.png' %}">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <!-- Swiper -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    
    {% block extra_css %}{% endblock %}
    
    <!-- Structured Data (Schema.org) -->
    {% block structured_data %}
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "LocalBusiness",
        "name": "Яркий Город",
        "description": "Рекламное агентство полного цикла в Петрозаводске. Изготовление и монтаж наружной рекламы, вывески, световые буквы, оклейка авто.",
        "url": "{{ request.scheme }}://{{ request.get_host }}",
        "logo": "{{ request.scheme }}://{{ request.get_host }}{% static 'img/Logo.png' %}",
        {% if settings %}
        "telephone": "{{ settings.phone }}",
        "email": "{{ settings.email }}",
        "address": {
            "@type": "PostalAddress",
            "streetAddress": "{{ settings.address }}",
            "addressLocality": "Петрозаводск",
            "addressRegion": "Республика Карелия",
            "addressCountry": "RU"
        },
        {% endif %}
        "priceRange": "$$",
        "areaServed": {
            "@type": "City",
            "name": "Петрозаводск"
        },
        "hasOfferCatalog": {
            "@type": "OfferCatalog",
            "name": "Услуги рекламного агентства",
            "itemListElement": [
                {
                    "@type": "Offer",
                    "itemOffered": {
                        "@type": "Service",
                        "name": "Наружная реклама"
                    }
                },
                {
                    "@type": "Offer",
                    "itemOffered": {
                        "@type": "Service",
                        "name": "Вывески"
                    }
                },
                {
                    "@type": "Offer",
                    "itemOffered": {
                        "@type": "Service",
                        "name": "Световые буквы"
                    }
                },
                {
                    "@type": "Offer",
                    "itemOffered": {
                        "@type": "Service",
                        "name": "Оклейка авто"
                    }
                }
            ]
        }
    }
    </script>
    {% endblock %}
</head>
<body>
    <!-- Header -->
    <header class="header" id="header">
        <div class="container">
            <nav class="navbar navbar-expand-lg">
                <div class="container-fluid">
                    <!-- Logo -->
                    <a class="navbar-brand" href="{% url 'main:home' %}">
                        <img src="{% static 'img/Logo.png' %}" alt="Яркий Город" class="logo-image">
                    </a>
                    
                    <!-- Mobile Toggle -->
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    
                    <!-- Navigation -->
                    <div class="collapse navbar-collapse" id="navbarNav">
                        <ul class="navbar-nav ms-auto align-items-center">
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'main:home' %}">Главная</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'services:catalog' %}">Каталог</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'portfolio:list' %}">Наши работы</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'main:about' %}">О нас</a>
                            </li>
                            
                            <!-- Contact Info -->
                            {% if settings %}
                            <li class="nav-item ms-lg-4">
                                <a href="tel:{{ settings.phone }}" class="contact-link">
                                    <i class="icon-phone"></i>
                                    {{ settings.phone_formatted|default:settings.phone }}
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="mailto:{{ settings.email }}" class="contact-link">
                                    <i class="icon-email"></i>
                                    {{ settings.email }}
                                </a>
                            </li>
                            {% endif %}
                            
                            <li class="nav-item ms-lg-3">
                                <button type="button" class="btn btn-primary btn-order" data-bs-toggle="modal" data-bs-target="#callbackModal">
                                    Заказать звонок
                                </button>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row g-4">
                <!-- Company Info -->
                <div class="col-lg-4 col-md-6">
                    <div class="footer-logo">
                        <img src="{% static 'img/Logo_lite.png' %}" alt="Яркий Город" class="footer-logo-image">
                    </div>
                    <p class="footer-description">
                        Мы — небольшое агентство полного цикла, и это наш осознанный выбор. 
                        Мы ценим душевный подход и внимание к деталям.
                    </p>
                </div>
                
                <!-- Quick Links -->
                <div class="col-lg-2 col-md-6 footer-nav-col">
                    <h5 class="footer-title">Навигация</h5>
                    <ul class="footer-menu">
                        <li><a href="{% url 'services:catalog' %}">Каталог</a></li>
                        <li><a href="{% url 'portfolio:list' %}">Наши работы</a></li>
                        <li><a href="{% url 'main:about' %}">О нас</a></li>
                        <li><a href="#contacts">Контакты</a></li>
                    </ul>
                </div>
                
                <!-- Contact Info -->
                <div class="col-lg-3 col-md-6 footer-contacts-col">
                    {% if settings %}
                    <h5 class="footer-title footer-contacts-title">Контакты</h5>
                    <ul class="footer-contacts">
                        <li>
                            <i class="icon-phone"></i>
                            <a href="tel:{{ settings.phone }}">{{ settings.phone_formatted|default:settings.phone }}</a>
                        </li>
                        <li>
                            <i class="icon-email"></i>
                            <a href="mailto:{{ settings.email }}">{{ settings.email }}</a>
                        </li>
                        <li>
                            <i class="icon-location"></i>
                            {{ settings.address }}
                        </li>
                    </ul>
                    {% endif %}
                </div>
                
                <!-- Working Hours & Social -->
                <div class="col-lg-3 col-md-6">
                    {% if settings %}
                    
                    <div class="social-links mt-4">
                        {% if settings.telegram_link %}
                        <a href="{{ settings.telegram_link }}" target="_blank" class="social-link social-telegram" aria-label="Telegram">
                            <i class="bi bi-telegram"></i>
                        </a>
                        {% endif %}
                        {% if settings.instagram_link %}
                        <!-- Instagram removed as requested -->
                        {% endif %}
                        {% if settings.vk_link %}
                        <a href="{{ settings.vk_link }}" target="_blank" class="social-link social-vk" aria-label="VK">
                            <svg class="social-icon-vk" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M15.07 2H8.93C3.33 2 2 3.33 2 8.93v6.14C2 20.67 3.33 22 8.93 22h6.14c5.6 0 6.93-1.33 6.93-6.93V8.93C22 3.33 20.67 2 15.07 2zm3.39 14.66h-1.48c-.62 0-.81-.5-1.93-1.62-1-.93-1.43-1.06-1.68-1.06-.35 0-.45.1-.45.57v1.48c0 .4-.13.64-1.18.64-1.75 0-3.69-1.06-5.07-3.04-2.06-2.93-2.63-5.14-2.63-5.6 0-.25.1-.48.57-.48h1.48c.43 0 .6.2.76.65.86 2.43 2.29 4.56 2.88 4.56.22 0 .32-.1.32-.66v-2.56c-.07-1.12-.65-1.21-.65-1.61 0-.2.17-.4.43-.4h2.33c.36 0 .5.2.5.63v3.47c0 .36.16.5.27.5.22 0 .4-.14.82-.56 1.26-1.42 2.17-3.62 2.17-3.62.12-.25.32-.48.75-.48h1.48c.53 0 .65.27.53.63-.19.86-2.07 3.52-2.07 3.52-.18.3-.25.44 0 .77.18.25.79.77 1.2 1.24.74.82 1.31 1.5 1.46 1.98.15.47-.08.71-.56.71z"/>
                            </svg>
                        </a>
                        {% endif %}
                        {% if settings.whatsapp_link %}
                        <a href="{{ settings.whatsapp_link }}" target="_blank" class="social-link social-whatsapp" aria-label="WhatsApp">
                            <i class="bi bi-whatsapp"></i>
                        </a>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <hr class="footer-divider">
            
            <div class="footer-bottom">
                <p class="copyright">© {% now "Y" %} Яркий Город — Рекламное агентство полного цикла</p>
            </div>
        </div>
    </footer>

    <!-- Callback Modal -->
    <div class="modal fade" id="callbackModal" tabindex="-1" aria-labelledby="callbackModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content callback-modal">
                <button type="button" class="btn-close callback-modal-close" data-bs-dismiss="modal" aria-label="Закрыть">
                    <i class="bi bi-x-lg"></i>
                </button>
                
                <div class="modal-body">
                    <div class="callback-modal-header">
                        <div class="callback-icon">
                            <i class="bi bi-telephone-fill"></i>
                        </div>
                        <h2 class="callback-title">Заказать звонок</h2>
                        <p class="callback-subtitle">Оставьте свой номер телефона и мы свяжемся с вами в ближайшее время</p>
                    </div>
                    
                    <form id="callbackForm" class="callback-form" method="post" action="{% url 'contacts:contact_form' %}">
                        {% csrf_token %}
                        <input type="hidden" name="is_callback" value="true">
                        <input type="hidden" name="service_context" id="serviceContext" value="">
                        
                        <div class="form-group mb-3">
                            <label for="callbackName" class="form-label">Ваше имя *</label>
                            <div class="input-with-icon">
                                <i class="bi bi-person-fill"></i>
                                <input type="text" class="form-control" id="callbackName" name="name" placeholder="Иван Иванов" required>
                            </div>
                        </div>
                        
                        <div class="form-group mb-3">
                            <label for="callbackPhone" class="form-label">Телефон *</label>
                            <div class="input-with-icon">
                                <i class="bi bi-telephone-fill"></i>
                                <input type="tel" class="form-control" id="callbackPhone" name="phone" placeholder="+7 (900) 123-45-67" required>
                            </div>
                        </div>
                        
                        <div class="form-group mb-4">
                            <label for="callbackMessage" class="form-label">Комментарий (необязательно)</label>
                            <div class="input-with-icon">
                                <i class="bi bi-chat-dots-fill"></i>
                                <textarea class="form-control" id="callbackMessage" name="message" rows="3" placeholder="Опишите ваш проект или вопрос"></textarea>
                            </div>
                        </div>
                        
                        <div class="form-check mb-4">
                            <input class="form-check-input" type="checkbox" id="callbackPrivacy" name="privacy_policy" required>
                            <label class="form-check-label" for="callbackPrivacy">
                                Я согласен с <a href="{% url 'main:privacy' %}" target="_blank" class="privacy-link">политикой конфиденциальности</a>
                            </label>
                        </div>
                        
                        <button type="submit" class="btn btn-primary btn-lg w-100 callback-submit">
                            <span class="btn-text">Отправить заявку</span>
                            <i class="bi bi-arrow-right ms-2"></i>
                        </button>
                        
                        <p class="callback-note">Мы перезвоним вам в течение 15 минут в рабочее время</p>
                    </form>
                    
                    <div id="callbackSuccess" class="callback-success" style="display: none;">
                        <div class="success-icon">
                            <i class="bi bi-check-circle-fill"></i>
                        </div>
                        <h3 class="success-title">Спасибо за обращение!</h3>
                        <p class="success-text">Ваша заявка принята. Мы свяжемся с вами в ближайшее время.</p>
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Закрыть</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cookie Consent Banner -->
    <div id="cookieConsent" class="cookie-consent">
        <div class="cookie-consent-content">
            <p class="cookie-consent-text">
                Этот сайт использует файлы cookies и сервисы сбора технических данных посетителей. Продолжая использовать наш сайт, вы автоматически соглашаетесь с использованием данных технологий. 
                <a href="{% url 'main:privacy' %}" target="_blank" class="cookie-policy-link">Политика конфиденциальности</a>
            </p>
            <button id="acceptCookies" class="btn btn-primary cookie-consent-btn">СОГЛАСИТЬСЯ</button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="{% static 'js/main.js' %}"></script>
    
    <!-- Cookie Consent Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const cookieConsent = document.getElementById('cookieConsent');
            const acceptButton = document.getElementById('acceptCookies');
            
            // Проверяем, согласился ли пользователь ранее
            if (!localStorage.getItem('cookiesAccepted')) {
                cookieConsent.classList.add('show');
            }
            
            // Обработчик клика на кнопку
            acceptButton.addEventListener('click', function() {
                localStorage.setItem('cookiesAccepted', 'true');
                cookieConsent.classList.remove('show');
            });
        });
    </script>
    
    <!-- Callback Modal Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const callbackForm = document.getElementById('callbackForm');
            const callbackSuccess = document.getElementById('callbackSuccess');
            
            if (callbackForm) {
                callbackForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const formData = new FormData(this);
                    const submitBtn = this.querySelector('.callback-submit');
                    const btnText = submitBtn.querySelector('.btn-text');
                    const originalText = btnText.textContent;
                    
                    // Показываем загрузку
                    submitBtn.disabled = true;
                    btnText.textContent = 'Отправка...';
                    
                    // Отправляем форму
                    fetch(this.action, {
                        method: 'POST',
                        body: formData,
                        headers: {
                            'X-Requested-With': 'XMLHttpRequest'
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Скрываем форму и показываем success
                            callbackForm.style.display = 'none';
                            callbackSuccess.style.display = 'block';
                            
                            // Сбрасываем форму
                            callbackForm.reset();
                            
                            // Через 5 секунд возвращаем форму
                            setTimeout(() => {
                                callbackForm.style.display = 'block';
                                callbackSuccess.style.display = 'none';
                                submitBtn.disabled = false;
                                btnText.textContent = originalText;
                            }, 5000);
                        } else {
                            alert('Ошибка отправки формы. Пожалуйста, попробуйте позже.');
                            submitBtn.disabled = false;
                            btnText.textContent = originalText;
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('Ошибка отправки формы. Пожалуйста, попробуйте позже.');
                        submitBtn.disabled = false;
                        btnText.textContent = originalText;
                    });
                });
            }
            
            // Маска для телефона
            const phoneInput = document.getElementById('callbackPhone');
            if (phoneInput) {
                phoneInput.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\D/g, '');
                    
                    if (value.length > 0) {
                        if (value[0] === '8') value = '7' + value.slice(1);
                        if (value[0] !== '7') value = '7' + value;
                    }
                    
                    let formattedValue = '';
                    if (value.length > 0) {
                        formattedValue = '+7';
                        if (value.length > 1) formattedValue += ' (' + value.substring(1, 4);
                        if (value.length >= 4) formattedValue += ') ' + value.substring(4, 7);
                        if (value.length >= 7) formattedValue += '-' + value.substring(7, 9);
                        if (value.length >= 9) formattedValue += '-' + value.substring(9, 11);
                    }
                    
                    e.target.value = formattedValue;
                });
            }
            
            // Автоматическое заполнение контекста услуги
            const callbackModal = document.getElementById('callbackModal');
            const serviceContextInput = document.getElementById('serviceContext');
            
            if (callbackModal && serviceContextInput) {
                callbackModal.addEventListener('show.bs.modal', function(event) {
                    // Получаем кнопку, которая открыла модалку
                    const button = event.relatedTarget;
                    
                    // Сбрасываем контекст при открытии
                    serviceContextInput.value = '';
                    
                    // Если открыто со страницы услуги, заполняем контекст
                    // Проверяем наличие заголовка услуги на странице
                    const serviceTitle = document.querySelector('.service-detail-title');
                    if (serviceTitle) {
                        serviceContextInput.value = 'Заявка с услуги: ' + serviceTitle.textContent.trim();
                    }
                    
                    // Обновляем заголовок модалки в зависимости от контекста
                    const modalTitle = callbackModal.querySelector('.callback-title');
                    const modalSubtitle = callbackModal.querySelector('.callback-subtitle');
                    
                    if (serviceTitle) {
                        modalTitle.textContent = 'Заказать ' + serviceTitle.textContent.trim();
                        modalSubtitle.textContent = 'Оставьте свои контакты, и наш менеджер свяжется с вами для уточнения деталей';
                    } else {
                        modalTitle.textContent = 'Заказать звонок';
                        modalSubtitle.textContent = 'Оставьте свой номер телефона и мы свяжемся с вами в ближайшее время';
                    }
                });
            }
        });
    </script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>

